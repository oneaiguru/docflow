# Анализ oneaiguru/AZ_ydb-js-sdk

Ниже приведены основные наблюдения после просмотра исходного кода и конфигурации репозитория.

## Обнаруженные проблемы и недоработки

1. **Не реализована человеко‑читабельная статистика запросов**. В модуле `@ydbjs/query` метод `stats()` пока возвращает внутреннюю структуру `QueryStats` и помечен `TODO` для возврата более удобного отчёта【F:packages/query/src/query.ts†L393-L396】.
2. **Провайдер токена не поддерживает чтение из файлов**. В `AccessTokenCredentialsProvider` указан `TODO` по добавлению возможности загрузки токена из файла【F:packages/auth/src/access-token.ts†L3-L6】.
3. **Ручной полифилл `Promise.withResolvers`**. В драйвере ядра реализован собственный полифилл для `Promise.withResolvers`, что может привести к несовместимости при обновлениях Node.js и усложняет сопровождение【F:packages/core/src/driver.ts†L76-L90】.
4. **Дискавери запускается периодическим таймером**. При включённом `enable_discovery` используется `setInterval` с `unref`, что требует аккуратного управления таймером при завершении работы драйвера【F:packages/core/src/driver.ts†L208-L216】.
5. **Жёсткое требование современных версий Node.js и npm**. В корневом `package.json` указаны минимальные версии `node >=20.19.0` и `npm >=10`, что может ограничить использование SDK в более старых окружениях【F:package.json†L12-L16】.

## Рекомендации по улучшению

- Реализовать преобразование статистики запросов в человеко‑читабельный формат и добавить примеры использования.
- Добавить поддержку чтения токена из файла или других источников (переменные окружения, безопасные хранилища).
- Рассмотреть вынесение полифилла `Promise.withResolvers` в отдельный утилитарный модуль или отказаться от него после появления встроенной поддержки в целевых версиях Node.js.
- Дополнительно проверить корректное завершение периодического таймера дискавери и предусмотреть метрики/логирование для контроля его работы.
- По возможности расширить диапазон поддерживаемых версий Node.js либо явно документировать причины жёсткого требования.

## Результаты запуска команд

- `npm audit` — уязвимости не обнаружены【48a2d0†L1-L20】.
- `npm test` — запуск прерван из‑за отсутствия `vitest`; требуется предварительная установка зависимостей【b6a8b5†L1-L4】.

